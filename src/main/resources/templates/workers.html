<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" type="image/png" href="/images/ico.png">
</head>
<body class="bg-gray-100 min-h-screen p-6">

<h1 class="text-3xl font-bold text-gray-800 mb-6">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</h1>

<!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ -->
<div class="mb-6">
    <a th:href="@{/workers/add}"
       class="bg-green-600 text-white px-4 py-2 rounded-lg shadow hover:bg-green-700 transition">
        + –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
    </a>
</div>
<!-- –í—Å—Ç–∞–≤—å –≤ —Å–≤–æ–π –≥–ª–∞–≤–Ω—ã–π —à–∞–±–ª–æ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, header.html –∏–ª–∏ layout.html) -->
<div style="position: fixed; top: 10px; right: 10px;">
    <form th:action="@{/logout}" method="get">
        <button type="submit"
                style="padding: 8px 12px; background-color: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer;">
            –í—ã–π—Ç–∏
        </button>
    </form>
</div>
<!-- üîé –§–æ—Ä–º–∞ –ø–æ–∏—Å–∫–∞ –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ -->
<form method="get" th:action="@{/workers/view}" class="mb-6 flex gap-4 items-center">
    <input type="text" name="search" th:value="${search}" placeholder="–ü–æ–∏—Å–∫ –ø–æ —Ñ–∞–º–∏–ª–∏–∏..."
           class="border rounded-lg px-4 py-2 w-1/3 shadow-sm">
    <!-- –§–∏–ª—å—Ç—Ä –ø–æ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ -->
    <select name="job" class="border rounded-lg px-4 py-2 w-1/4 shadow-sm">
        <option value="">–í—Å–µ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏</option>
        <option value="–≠–∫—Å–ø–µ—Ä—Ç" th:selected="${job == '–≠–∫—Å–ø–µ—Ä—Ç'}">–≠–∫—Å–ø–µ—Ä—Ç</option>
        <option value="–ì–ª–∞–≤–Ω—ã–π —ç–∫—Å–ø–µ—Ä—Ç" th:selected="${job == '–ì–ª–∞–≤–Ω—ã–π —ç–∫—Å–ø–µ—Ä—Ç'}">–ì–ª–∞–≤–Ω—ã–π —ç–∫—Å–ø–µ—Ä—Ç</option>
        <option value="–≠–∫—Å–ø–µ—Ä—Ç-—Å—Ç–∞–∂—ë—Ä" th:selected="${job == '–≠–∫—Å–ø–µ—Ä—Ç-—Å—Ç–∞–∂—ë—Ä'}">–≠–∫—Å–ø–µ—Ä—Ç-—Å—Ç–∞–∂—ë—Ä</option>
        <option value="–ù–∞—á–∞–ª—å–Ω–∏–∫ –æ—Ç–¥–µ–ª–∞" th:selected="${job == '–ù–∞—á–∞–ª—å–Ω–∏–∫ –æ—Ç–¥–µ–ª–∞'}">–ù–∞—á–∞–ª—å–Ω–∏–∫ –æ—Ç–¥–µ–ª–∞</option>
        <option value="–ó–∞–º. –Ω–∞—á–∞–ª—å–Ω–∏–∫–∞ –æ—Ç–¥–µ–ª–∞" th:selected="${job == '–ó–∞–º. –Ω–∞—á–∞–ª—å–Ω–∏–∫–∞ –æ—Ç–¥–µ–ª–∞'}">–ó–∞–º. –Ω–∞—á–∞–ª—å–Ω–∏–∫–∞ –æ—Ç–¥–µ–ª–∞</option>
    </select>
    <!-- –í—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –¥–ª—è –æ—Ç–¥–µ–ª–∞ -->
    <select name="department" class="border rounded-lg px-4 py-2 w-1/4 shadow-sm">
        <option value="">–í—Å–µ –æ—Ç–¥–µ–ª—ã</option>
        <option value="–û—Ç–¥–µ–ª –≠–ö–°–∏–¢–§–∏–õ–≠" th:selected="${department == '–û—Ç–¥–µ–ª –≠–ö–°–∏–¢–§–∏–õ–≠'}">–û—Ç–¥–µ–ª –≠–ö–°–∏–¢–§–∏–õ–≠</option>
        <option value="–û—Ç–¥–µ–ª –°–¢–¢–∏–≠–≠" th:selected="${department == '–û—Ç–¥–µ–ª –°–¢–¢–∏–≠–≠'}">–û—Ç–¥–µ–ª –°–¢–¢–∏–≠–≠</option>
    </select>
    <select name="sort" class="border rounded-lg px-4 py-2 shadow-sm">
        <option value="">–ë–µ–∑ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏</option>
        <option value="surname" th:selected="${sort == 'surname'}">–ü–æ —Ñ–∞–º–∏–ª–∏–∏</option>
        <option value="birthDay" th:selected="${sort == 'birthDay'}">–ü–æ –¥–∞—Ç–µ —Ä–æ–∂–¥–µ–Ω–∏—è</option>
        <option value="isVacated" th:selected="${sort == 'isVacated'}">–ü–æ –æ—Ç–ø—É—Å–∫—É</option>
        <option value="isVacatedIn3Months" th:selected="${sort == 'isVacatedIn3Months'}">–ü–æ –æ—Ç–ø—É—Å–∫—É –≤ 3 –º–µ—Å.</option>
        <option value="isCategoryNextYear" th:selected="${sort == 'isCategoryNextYear'}">–ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ —Å–ª–µ–¥. –≥–æ–¥—É</option>
        <option value="isTrainNextMonth" th:selected="${sort == 'isTrainNextMonth'}">–ü–æ —Å—Ç–∞–∂–∏—Ä–æ–≤–∫–µ</option>
        <option value="isEccNextMonth" th:selected="${sort == 'isEccNextMonth'}">–ü–æ –≠–ö–ö</option>
        <option value="isQualificationNextMonth" th:selected="${sort == 'isQualificationNextMonth'}">–ü–æ –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏</option>
        <option value="isCategoryNext3Month" th:selected="${sort == 'isCategoryNext3Month'}">–ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ 3 –º–µ—Å.</option>
        <option value="isBday5" th:selected="${sort == 'isBday5'}">–ü–æ —é–±–∏–ª–µ—é (5 –ª–µ—Ç)</option>
    </select>
    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-lg shadow hover:bg-blue-700 transition">
        –ü—Ä–∏–º–µ–Ω–∏—Ç—å
    </button>
    <a href="/workers/view" class="bg-red-600 text-white px-4 py-2 rounded-lg shadow hover:bg-red-700 transition">
        –°–±—Ä–æ—Å–∏—Ç—å
    </a>
</form>

<!-- üìã –°–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ -->
<div class="grid grid-cols-3 gap-6">
    <a th:each="worker : ${workers}"
       th:href="@{/workers/view/{workerId}(workerId=${worker.id})}"
       class="block bg-white shadow-lg rounded-2xl p-6 border border-gray-200 hover:shadow-xl transition duration-300">

        <!-- –§–ò–û -->
        <h2 class="text-xl font-bold text-gray-800 mb-2"
            th:text="${worker.surname + ' ' + worker.name + ' ' + worker.patronymicName}"></h2>

        <!-- –î–æ–ª–∂–Ω–æ—Å—Ç—å -->
        <p class="text-gray-600 mb-2" th:text="${worker.jobTitle}"></p>

        <!-- –û—Ç–¥–µ–ª -->
        <p class="text-gray-600 mb-2">üè¢ <span th:text="${worker.department}"></span></p>

        <!-- –î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è + –≤–æ–∑—Ä–∞—Å—Ç -->
        <p class="text-gray-700 mb-2">
            üéÇ –î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è:
            <span th:text="${#temporals.format(worker.birthDay, 'dd.MM.yyyy')}"></span>
            (<span th:text="${#temporals.createNow().year - worker.birthDay.year}"></span>)
        </p>

        <!-- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –¥–æ –∫–æ–Ω—Ü–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
        <p th:if="${lastCategoryEndDates[worker.id] != null}"
           th:with="daysLeft=${T(java.time.temporal.ChronoUnit).DAYS.between(#temporals.createToday(), lastCategoryEndDates[worker.id])},
            colorClass=${daysLeft > 1095 ? 'bg-green-100 text-green-800 p-2 rounded-lg' : (daysLeft > 730 ? 'bg-yellow-100 text-yellow-800 p-2 rounded-lg' : 'bg-red-100 text-red-800 p-2 rounded-lg')}"
           th:classappend="${colorClass}"
           class="text-gray-700 mb-2">
            üèÜ –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:
            <span th:text="${#temporals.format(lastCategoryEndDates[worker.id], 'dd.MM.yyyy')}"></span>
            (<span th:text="${daysLeft}"></span> –¥–Ω–µ–π –¥–æ —Å–¥–∞—á–∏)
        </p>

        <p th:if="${vacationStartDates[worker.id]} != null"
           class="text-gray-700 mb-2 bg-blue-50 text-blue-900 p-2 rounded-lg">

            üå¥ –ë–ª–∏–∂–∞–π—à–∏–π –æ—Ç–ø—É—Å–∫:
            <span th:text="${#temporals.format(vacationStartDates[worker.id], 'dd.MM.yyyy')}"></span>
            ‚Äì
            <span th:text="${#temporals.format(vacationEndDates[worker.id], 'dd.MM.yyyy')}"></span>
        </p>

        <p th:if="${worker.isVacated and nowOnVacationEndDates[worker.id] != null}"
           class="text-white bg-blue-600 p-2 rounded-lg mb-2 shadow">
            üå¥ –°–æ—Ç—Ä—É–¥–Ω–∏–∫ –≤ –æ—Ç–ø—É—Å–∫–µ –¥–æ
            <span th:text="${#temporals.format(nowOnVacationEndDates[worker.id], 'dd.MM.yyyy')}"></span>
        </p>



        <!-- –§–ª–∞–∂–∫–∏ -->
        <div>
            <h3 class="text-base font-semibold text-gray-800 mb-2">–ê–∫—Ç–∏–≤–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è:</h3>
            <ul class="space-y-2 text-base">
                <li th:if="${worker.isVacated}">
                    <span class="inline-block bg-blue-100 text-blue-800 font-medium px-3 py-1 rounded-lg shadow">üå¥ –í –æ—Ç–ø—É—Å–∫–µ</span>
                </li>
                <li th:if="${worker.isVacatedIn3Months}">
                    <span class="inline-block bg-green-100 text-green-800 font-medium px-3 py-1 rounded-lg shadow">üìÖ –û—Ç–ø—É—Å–∫ –≤ –±–ª–∏–∂–∞–π—à–∏–µ 3 –º–µ—Å—è—Ü–∞</span>
                </li>
                <li th:if="${worker.isCategoryNextYear}">
                    <span class="inline-block bg-yellow-100 text-yellow-800 font-medium px-3 py-1 rounded-lg shadow">üèÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è –≤ —Å–ª–µ–¥—É—é—â–µ–º –≥–æ–¥—É</span>
                </li>
                <li th:if="${worker.isTrainNextMonth}">
                    <span class="inline-block bg-red-100 text-red-800 font-medium px-3 py-1 rounded-lg shadow">üßë‚Äçüéì –°—Ç–∞–∂–∏—Ä–æ–≤–∫–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–º –º–µ—Å—è—Ü–µ</span>
                </li>
                <li th:if="${worker.isEccNextMonth}">
                    <span class="inline-block bg-red-200 text-red-900 font-bold px-3 py-1 rounded-lg shadow">‚ö†Ô∏è –≠–ö–ö –≤ —Å–ª–µ–¥—É—é—â–µ–º –º–µ—Å—è—Ü–µ</span>
                </li>
                <li th:if="${worker.isQualificationNextMonth}">
                    <span class="inline-block bg-red-100 text-red-800 font-medium px-3 py-1 rounded-lg shadow">üìñ –ü–æ–≤—ã—à–µ–Ω–∏–µ –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏</span>
                </li>
                <li th:if="${worker.isCategoryNext3Month}">
                    <span class="inline-block bg-orange-100 text-orange-800 font-medium px-3 py-1 rounded-lg shadow">üî∂ –ö–∞—Ç–µ–≥–æ—Ä–∏—è –≤ –±–ª–∏–∂–∞–π—à–∏–µ 3 –º–µ—Å—è—Ü–∞</span>
                </li>
                <li th:if="${worker.isBday5}">
                    <span class="inline-block bg-purple-100 text-purple-800 font-medium px-3 py-1 rounded-lg shadow">üéâ –Æ–±–∏–ª–µ–π–Ω—ã–π –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è (5 –ª–µ—Ç)</span>
                </li>
            </ul>
        </div>
    </a>
</div>

<!-- üìå JS –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏ -->
<script>
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–∑–∏—Ü–∏—é –ø—Ä–∏ —É—Ö–æ–¥–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    window.addEventListener("beforeunload", function () {
        localStorage.setItem("scrollPosition", window.scrollY);
    });

    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    window.addEventListener("load", function () {
        const scrollPos = localStorage.getItem("scrollPosition");
        if (scrollPos !== null) {
            window.scrollTo(0, parseInt(scrollPos));
            localStorage.removeItem("scrollPosition"); // —á—Ç–æ–±—ã –Ω–µ –ø—Ä—ã–≥–∞–ª–æ –ø—Ä–∏ F5
        }
    });
</script>

</body>
</html>
