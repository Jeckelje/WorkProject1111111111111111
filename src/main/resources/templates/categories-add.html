<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" type="image/png" href="/images/ico.png">

</head>
<body class="bg-gray-100 min-h-screen p-6">

<h1 class="text-3xl font-bold text-gray-800 mb-6">
    –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É: <span th:text="${worker.surname + ' ' + worker.name + ' ' + worker.patronymicName}"></span>
</h1>

<form th:action="@{/workers/view/{workerId}/categories/add(workerId=${category.workerId})}"
      th:object="${category}" method="post"
      onsubmit="return validateDates()"
      class="bg-white p-6 rounded-xl shadow-md w-1/2">

    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

    <label class="block mb-2 font-semibold text-gray-700">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</label>
    <input type="text" th:field="*{title}" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü–µ—Ä–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è"
           class="w-full border rounded-lg px-3 py-2 mb-4 shadow-sm" required>

    <label class="block mb-2 font-semibold text-gray-700">–î–∞—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∏—è</label>
    <input type="date" id="startDate" th:field="*{start}"
           class="w-full border rounded-lg px-3 py-2 mb-4 shadow-sm" required
           onchange="updateEndDate()">

    <label class="block mb-2 font-semibold text-gray-700">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</label>
    <input type="date" id="endDate" th:field="*{end}"
           class="w-full border rounded-lg px-3 py-2 mb-4 shadow-sm" required readonly>

    <script>
        function updateEndDate() {
            const startInput = document.getElementById("startDate");
            const endInput = document.getElementById("endDate");

            if (!startInput.value) {
                endInput.value = '';
                return;
            }

            const startDate = new Date(startInput.value);
            const endDate = new Date(startDate);
            endDate.setFullYear(endDate.getFullYear() + 3); // –ø—Ä–∏–±–∞–≤–ª—è–µ–º 3 –≥–æ–¥–∞

            // —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤ yyyy-mm-dd –¥–ª—è input type=date
            const yyyy = endDate.getFullYear();
            const mm = String(endDate.getMonth() + 1).padStart(2, '0');
            const dd = String(endDate.getDate()).padStart(2, '0');
            endInput.value = `${yyyy}-${mm}-${dd}`;
        }

        function validateDates() {
            const start = document.getElementById("startDate").value;
            const end = document.getElementById("endDate").value;
            if (start && end && new Date(end) < new Date(start)) {
                alert("–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–Ω—å—à–µ –¥–∞—Ç—ã –ø–æ–ª—É—á–µ–Ω–∏—è!");
                return false;
            }
            return true;
        }
    </script>

    <label class="block mb-2 font-semibold text-gray-700">–û–ø–∏—Å–∞–Ω–∏–µ</label>
    <textarea th:field="*{description}" placeholder="(–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"
              class="w-full border rounded-lg px-3 py-2 mb-4 shadow-sm"></textarea>

    <div class="flex gap-4 mt-4">
        <button type="submit"
                class="bg-blue-600 text-white px-4 py-2 rounded-lg shadow hover:bg-blue-700 transition">
            üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
        </button>
        <a th:href="@{/workers/view/{workerId}/categories(workerId=${category.workerId})}"
           class="bg-red-600 text-white px-4 py-2 rounded-lg shadow hover:bg-red-700 transition">
            ‚ùå –û—Ç–º–µ–Ω–∞
        </a>
    </div>
</form>

<script>
    function validateDates() {
        const start = document.getElementById("startDate").value;
        const end = document.getElementById("endDate").value;
        if (start && end && new Date(end) < new Date(start)) {
            alert("–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–Ω—å—à–µ –¥–∞—Ç—ã –ø–æ–ª—É—á–µ–Ω–∏—è!");
            return false;
        }
        return true;
    }
</script>

</body>
</html>
